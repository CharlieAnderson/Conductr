<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">
    <title>
      Mozilla Labs : TogetherJS
    </title>
    <meta name="viewport" content="width=320, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/>
    <meta name="description" content="Real time collaboration features for your website or app.">
    <meta name="author" content="">
    <link rel="shortcut icon" href="../images/fav-icon.ico">

    <!-- use this block to set togetherjs config -->
    

    <script src="../js/jquery-1.10.2.min.js"></script>
    <script src="../js/bootstrap.min.js"></script>
    <script src="../js/parallax.js"></script>
    <script src="../js/custom.js"></script>
    <script src="../js/scrollTo.js"></script>
    <script src="../js/scrollspy.js"></script>
    <script src="../js/waypoints.min.js"></script>
    <script src="../js/how-animations.js"></script>
    <script src="../togetherjs.js"></script>

    <!-- retina library -->
    <script src="../js/retina.js"></script>

    <script src="//mozorg.cdn.mozilla.net/tabzilla/tabzilla.js"></script>

    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-35433268-28']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>

    <!-- Bootstrap core CSS -->
    <link href="../css/bootstrap.css" rel="stylesheet">
    <link href="../css/jumbotron.css" rel="stylesheet">
    <link href="../css/carousel.css" rel="stylesheet">
    <link href="../css/grid.css" rel="stylesheet">
    <link href="../css/style.css" rel="stylesheet">
    <link href="//mozorg.cdn.mozilla.net/media/css/tabzilla-min.css" rel="stylesheet" />

    
  <link rel="stylesheet" href="../css/docco.css">
  <script src="../js/source-code.js"></script>


    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js">
      </script>
    <![endif]-->
    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="../assets/ico/favicon.ico">
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="../assets/ico/apple-touch-icon-57-precomposed.png">

    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-35433268-43', 'togetherjs.com');
    ga('send', 'pageview');
    </script>

  </head>
  <body >
    <div class="navbar main-header" id="main-navbar">

      <!-- Tabzilla -->
      <a href="https://www.mozilla.org/" id="tabzilla">mozilla</a>

      <!-- start container -->
      <div class="container navbox">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand main-logo" href=".././"></a>
          <a class="navbar-brand masthead-title" href=".././">TogetherJS</a>
        </div>

        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav navbar-right main-nav">
            <li><a href=".././"  >Overview</a></li>
            <li><a class="documentationActive"href=".././docs/"  >Documentation</a></li>
            <li><a href="https://github.com/mozilla/togetherjs" target="_blank">Github</a></li>
            <li><a href="mailto:togetherjs@mozilla.com">Contact</a></li>
          </ul>
        </div><!--/.navbar-collapse -->

      </div>
    </div>


    

<div class="container">

    <section class="row" id="sourcecode">
      <div class="col-md-3" id="source-toc">
        <div class="panel" role="complementary" data-spy="affix" data-offset-top="200" id="sidenav">
          <div class="panel-heading">Source Code</div>
          <ul class="nav" id="sectionmenu">
            
              <li><a href="analytics.js.html">analytics</a></li>
            
              <li><a href="channels.js.html">channels</a></li>
            
              <li><a href="chat.js.html">chat</a></li>
            
              <li><a href="console.js.html">console</a></li>
            
              <li><a href="cursor.js.html">cursor</a></li>
            
              <li><a href="elementFinder.js.html">elementFinder</a></li>
            
              <li><a href="eventMaker.js.html">eventMaker</a></li>
            
              <li><a href="forms.js.html">forms</a></li>
            
              <li><a href="jqueryPlugins.js.html">jqueryPlugins</a></li>
            
              <li><a href="linkify.js.html">linkify</a></li>
            
              <li><a href="ot.js.html">ot</a></li>
            
              <li><a href="peers.js.html">peers</a></li>
            
              <li><a href="playback.js.html">playback</a></li>
            
              <li><a href="randomutil.js.html">randomutil</a></li>
            
              <li><a href="recorder.js.html">recorder</a></li>
            
              <li><a href="session.js.html">session</a></li>
            
              <li><a href="startup.js.html">startup</a></li>
            
              <li><a href="storage.js.html">storage</a></li>
            
              <li><a href="templates-localized.js.html">templates-localized</a></li>
            
              <li><a href="templates.js.html">templates</a></li>
            
              <li><a href="templating.js.html">templating</a></li>
            
              <li><a href="togetherjs.js.html">togetherjs</a></li>
            
              <li><a href="ui.js.html">ui</a></li>
            
              <li><a href="util.js.html">util</a></li>
            
              <li><a href="videos.js.html">videos</a></li>
            
              <li><a href="visibilityApi.js.html">visibilityApi</a></li>
            
              <li><a href="walkthrough.js.html">walkthrough</a></li>
            
              <li><a href="webrtc.js.html">webrtc</a></li>
            
              <li><a href="who.js.html">who</a></li>
            
              <li><a href="windowing.js.html">windowing</a></li>
            
              <li><a href="youtubeVideos.js.html">youtubeVideos</a></li>
            
          </ul>
        </div>
      </div>

      <div class="col-md-9" id="source-content">
        <h1>windowing.js</h1>
        
          <h4><p>Handles the creation of different windows, notifications, and modal windows.</p>
</h4>
        

        <div class="small"><a href="https://github.com/mozilla/togetherjs/blob/develop/togetherjs/windowing.js">See this file on Github</a></div>

        <ul class="sections">
          
            <li id="section-0">
              <div class="annotation">
                <div class="pilwrap">
                  <a class="pilcrow" href="#section-0">&#182;</a>
                </div>
                
              </div>
              
                <div class="content"><div class='highlight'><pre><span class="comment">/* This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
define([<span class="string">"jquery"</span>, <span class="string">"util"</span>, <span class="string">"peers"</span>, <span class="string">"session"</span>], <span class="function"><span class="keyword">function</span> <span class="params">($, util, peers, session)</span> {</span>
  <span class="keyword">var</span> assert = util.assert;
  <span class="keyword">var</span> windowing = util.Module(<span class="string">"windowing"</span>);
  <span class="keyword">var</span> $window = $(window);</pre></div></div>
              
            </li>
          
            <li id="section-1">
              <div class="annotation">
                <div class="pilwrap">
                  <a class="pilcrow" href="#section-1">&#182;</a>
                </div>
                <p>This is also in togetherjs.less, under .togetherjs-animated</p>

              </div>
              
                <div class="content"><div class='highlight'><pre>  <span class="keyword">var</span> ANIMATION_DURATION = <span class="number">1000</span>;

  <span class="comment">/* Displays one window.  A window must already exist.  This hides other windows, and
     positions the window according to its data-bound-to attributes */</span>
  windowing.show = <span class="function"><span class="keyword">function</span> <span class="params">(element, options)</span> {</span>
    element = $(element);
    options = options || {};
    options.bind = options.bind || element.attr(<span class="string">"data-bind-to"</span>);
    <span class="keyword">var</span> notification = element.hasClass(<span class="string">"togetherjs-notification"</span>);
    <span class="keyword">var</span> modal = element.hasClass(<span class="string">"togetherjs-modal"</span>);
    <span class="keyword">if</span> (options.bind) {
      options.bind = $(options.bind);
    }
    windowing.hide();
    element.stop();
    element.show();</pre></div></div>
              
            </li>
          
            <li id="section-2">
              <div class="annotation">
                <div class="pilwrap">
                  <a class="pilcrow" href="#section-2">&#182;</a>
                </div>
                <p>In addition to being hidden, the window can be faded out, which we want to undo:</p>

              </div>
              
                <div class="content"><div class='highlight'><pre>    element.css({opacity: <span class="string">"1"</span>});
    <span class="keyword">if</span> (options.bind) {
      assert(! modal, <span class="string">"Binding does not currently work with modals"</span>);
      bind(element, options.bind);
    }
    <span class="keyword">if</span> (notification) {
      element.slideIn();
    } <span class="keyword">else</span> <span class="keyword">if</span> (! modal) {
      element.popinWindow();
    }
    <span class="keyword">if</span> (modal) {
      getModalBackground().show();
      modalEscape.bind();
    }
    onClose = options.onClose || <span class="literal">null</span>;
    session.emit(<span class="string">"display-window"</span>, element.attr(<span class="string">"id"</span>), element);
  };

  <span class="keyword">var</span> onClose = <span class="literal">null</span>;

  <span class="comment">/* Moves a window to be attached to data-bind-to, e.g., the button
     that opened the window. Or you can provide an element that it should bind to. */</span>
  <span class="function"><span class="keyword">function</span> <span class="title">bind</span><span class="params">(win, bound)</span> {</span>
    <span class="keyword">if</span> ($.browser.mobile) {
      <span class="keyword">return</span>;
    }
    win = $(win);
    assert(bound.length, <span class="string">"Cannot find binding:"</span>, bound.selector, <span class="string">"from:"</span>, win.selector);</pre></div></div>
              
            </li>
          
            <li id="section-3">
              <div class="annotation">
                <div class="pilwrap">
                  <a class="pilcrow" href="#section-3">&#182;</a>
                </div>
                <p>FIXME: hardcoding</p>

              </div>
              
                <div class="content"><div class='highlight'><pre>    <span class="keyword">var</span> ifacePos = <span class="string">"right"</span>;</pre></div></div>
              
            </li>
          
            <li id="section-4">
              <div class="annotation">
                <div class="pilwrap">
                  <a class="pilcrow" href="#section-4">&#182;</a>
                </div>
                <p>var ifacePos = panelPosition();</p>

              </div>
              
                <div class="content"><div class='highlight'><pre>    <span class="keyword">var</span> boundPos = bound.offset();
    boundPos.height = bound.height();
    boundPos.width = bound.width();
    <span class="keyword">var</span> windowHeight = $window.height();
    boundPos.top -= $window.scrollTop();
    boundPos.left -= $window.scrollLeft();</pre></div></div>
              
            </li>
          
            <li id="section-5">
              <div class="annotation">
                <div class="pilwrap">
                  <a class="pilcrow" href="#section-5">&#182;</a>
                </div>
                <p>FIXME: I appear to have to add the padding to the width to get a “true”
width.  But it’s still not entirely consistent.</p>

              </div>
              
                <div class="content"><div class='highlight'><pre>    <span class="keyword">var</span> height = win.height() + <span class="number">5</span>;
    <span class="keyword">var</span> width = win.width() + <span class="number">20</span>;
    <span class="keyword">var</span> left, top;
    <span class="keyword">if</span> (ifacePos == <span class="string">"right"</span>) {
      left = boundPos.left - <span class="number">11</span> - width;
      top = boundPos.top + (boundPos.height / <span class="number">2</span>) - (height / <span class="number">2</span>);
    } <span class="keyword">else</span> <span class="keyword">if</span> (ifacePos == <span class="string">"left"</span>) {
      left = boundPos.left + boundPos.width + <span class="number">15</span>;
      top = boundPos.top + (boundPos.height / <span class="number">2</span>) - (height / <span class="number">2</span>);
    } <span class="keyword">else</span> <span class="keyword">if</span> (ifacePos == <span class="string">"bottom"</span>) {
      left = (boundPos.left + boundPos.width / <span class="number">2</span>) - (width / <span class="number">2</span>);
      top = boundPos.top - <span class="number">10</span> - height;
    }
    top = Math.min(windowHeight - <span class="number">10</span> - height, Math.max(<span class="number">10</span>, top));
    win.css({
      top: top + <span class="string">"px"</span>,
      left: left + <span class="string">"px"</span>
    });
    <span class="keyword">if</span> (win.hasClass(<span class="string">"togetherjs-window"</span>)) {
      $(<span class="string">"#togetherjs-window-pointer-right, #togetherjs-window-pointer-left"</span>).hide();
      <span class="keyword">var</span> pointer = $(<span class="string">"#togetherjs-window-pointer-"</span> + ifacePos);
      pointer.show();
      <span class="keyword">if</span> (ifacePos == <span class="string">"right"</span>) {
        pointer.css({
          top: boundPos.top + Math.floor(boundPos.height / <span class="number">2</span>) + <span class="string">"px"</span>,
          left: left + win.width() + <span class="number">9</span> + <span class="string">"px"</span>
        });
      } <span class="keyword">else</span> <span class="keyword">if</span> (ifacePos == <span class="string">"left"</span>) {
        pointer.css({
          top: boundPos.top + Math.floor(boundPos.height / <span class="number">2</span>) + <span class="string">"px"</span>,
          left: (left - <span class="number">5</span>) + <span class="string">"px"</span>
        });
      } <span class="keyword">else</span> {
        console.warn(<span class="string">"don't know how to deal with position:"</span>, ifacePos);
      }
    }
    win.data(<span class="string">"boundTo"</span>, bound.selector || <span class="string">"#"</span> + bound.attr(<span class="string">"id"</span>));
    bound.addClass(<span class="string">"togetherjs-active"</span>);
  }

  session.on(<span class="string">"resize"</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
    <span class="keyword">var</span> win = $(<span class="string">".togetherjs-modal:visible, .togetherjs-window:visible"</span>);
    <span class="keyword">if</span> (! win.length) {
      <span class="keyword">return</span>;
    }
    <span class="keyword">var</span> boundTo = win.data(<span class="string">"boundTo"</span>);
    <span class="keyword">if</span> (! boundTo) {
      <span class="keyword">return</span>;
    }
    boundTo = $(boundTo);
    bind(win, boundTo);
  });

  windowing.hide = <span class="function"><span class="keyword">function</span> <span class="params">(els)</span> {</span></pre></div></div>
              
            </li>
          
            <li id="section-6">
              <div class="annotation">
                <div class="pilwrap">
                  <a class="pilcrow" href="#section-6">&#182;</a>
                </div>
                <p>FIXME: also hide modals?</p>

              </div>
              
                <div class="content"><div class='highlight'><pre>    els = els || <span class="string">".togetherjs-window, .togetherjs-modal, .togetherjs-notification"</span>;
    els = $(els);
    els = els.filter(<span class="string">":visible"</span>);
    els.filter(<span class="string">":not(.togetherjs-notification)"</span>).hide();
    getModalBackground().hide();
    <span class="keyword">var</span> windows = [];
    els.each(<span class="function"><span class="keyword">function</span> <span class="params">(index, element)</span> {</span>
      element = $(element);
      windows.push(element);
      <span class="keyword">var</span> bound = element.data(<span class="string">"boundTo"</span>);
      <span class="keyword">if</span> (! bound) {
        <span class="keyword">return</span>;
      }
      bound = $(bound);
      bound.addClass(<span class="string">"togetherjs-animated"</span>).addClass(<span class="string">"togetherjs-color-pulse"</span>);
      setTimeout(<span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
        bound.removeClass(<span class="string">"togetherjs-color-pulse"</span>).removeClass(<span class="string">"togetherjs-animated"</span>);
      }, ANIMATION_DURATION+<span class="number">10</span>);
      element.data(<span class="string">"boundTo"</span>, <span class="literal">null</span>);
      bound.removeClass(<span class="string">"togetherjs-active"</span>);
      <span class="keyword">if</span> (element.hasClass(<span class="string">"togetherjs-notification"</span>)) {
        element.fadeOut().promise().then(<span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
          <span class="keyword">this</span>.hide();
        });
      }
    });
    $(<span class="string">"#togetherjs-window-pointer-right, #togetherjs-window-pointer-left"</span>).hide();
    <span class="keyword">if</span> (onClose) {
      onClose();
      onClose = <span class="literal">null</span>;
    }
    <span class="keyword">if</span> (windows.length) {
      session.emit(<span class="string">"hide-window"</span>, windows);
    }
  };

  windowing.showNotification = <span class="function"><span class="keyword">function</span> <span class="params">(element, options)</span> {</span>
    element = $(element);
    options = options || {};
    assert(<span class="literal">false</span>);
  };

  windowing.toggle = <span class="function"><span class="keyword">function</span> <span class="params">(el)</span> {</span>
    el = $(el);
    <span class="keyword">if</span> (el.is(<span class="string">":visible"</span>)) {
      windowing.hide(el);
    } <span class="keyword">else</span> {
      windowing.show(el);
    }
  };

  <span class="function"><span class="keyword">function</span> <span class="title">bindEvents</span><span class="params">(el)</span> {</span>
    el.find(<span class="string">".togetherjs-close, .togetherjs-dismiss"</span>).click(<span class="function"><span class="keyword">function</span> <span class="params">(event)</span> {</span>
      <span class="keyword">var</span> w = $(event.target).closest(<span class="string">".togetherjs-window, .togetherjs-modal, .togetherjs-notification"</span>);
      windowing.hide(w);
      event.stopPropagation();
      <span class="keyword">return</span> <span class="literal">false</span>;
    });
  }

  <span class="function"><span class="keyword">function</span> <span class="title">getModalBackground</span><span class="params">()</span> {</span>
    <span class="keyword">if</span> (getModalBackground.element) {
      <span class="keyword">return</span> getModalBackground.element;
    }
    <span class="keyword">var</span> background = $(<span class="string">"#togetherjs-modal-background"</span>);
    assert(background.length);
    getModalBackground.element = background;
    background.click(<span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
      windowing.hide();
    });
    <span class="keyword">return</span> background;
  }

  <span class="keyword">var</span> modalEscape = {
    bind: <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
      $(document).keydown(modalEscape.onKeydown);
    },
    unbind: <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
      $(document).unbind(<span class="string">"keydown"</span>, modalEscape.onKeydown);
    },
    onKeydown: <span class="function"><span class="keyword">function</span> <span class="params">(event)</span> {</span>
      <span class="keyword">if</span> (event.which == <span class="number">27</span>) {
        windowing.hide();
      }
    }
  };

  session.on(<span class="string">"close"</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
    modalEscape.unbind();
  });

  session.on(<span class="string">"new-element"</span>, <span class="function"><span class="keyword">function</span> <span class="params">(el)</span> {</span>
    bindEvents(el);
  });

  <span class="keyword">return</span> windowing;
});</pre></div></div>
              
            </li>
          
        </ul>
      </div>
    </section>






        <hr>

        <footer>

          <section class="row" id="footer">
            <div class="col-xs-12 col-sm-3 text-left">
              <p><a href="https://mozillalabs.com/en-US/" target="_blank"><img src="../images/footer-mozilla-labs.png"></a></p>
            </div>
            <div class="col-xs-12 col-sm-3">
              <ul class="list-unstyled text-left">
                <li class=""><a href=".././" class="">Overview</a></li>
                <li><a href=".././docs/" target="_blank">Docs</a></li>
                <li class=""><a href="https://github.com/mozilla/togetherjs" target="_blank">GitHub</a></li>
                <li class=""><a href="mailto:togetherjs@mozilla.com" target="_blank">Contact</a></li>
              </ul>
            </div>
            <div class="col-xs-12 col-sm-3">
              <ul class="list-unstyled text-left">
                <li class=""><a href="https://mozillalabs.com/en-US/togetherjs/" target="_blank">About</a></li>
                <li><a href=".././docs/contributing.html">Contributing</a></li>
                <li><a href="../source/">Source Code</a></li>
                <li><a href="../faq.html">FAQ</a></li>
                <li class=""><a href="https://twitter.com/togetherjs" target="_blank">Twitter</a></li>
              </ul>
            </div>
            <div class="col-xs-12 col-sm-3">
              <ul class="list-unstyled text-left">
                <li class=""><a href="https://www.mozilla.org/privacy/websites/" target="_blank">Privacy Policy</a></li>
                <li class=""><a href="https://www.mozilla.org/about/legal/" target="_blank">Legal Notices</a></li>
                <li class=""><a href="https://www.mozilla.org/legal/fraud-report/" target="_blank">Report Trademark Abuses</a></li>
                <li class="ph-credit">Thanks to Yuan Wang for the cover photo!</li>
              </ul>
            </div>
          </section>
        </footer>
      </section>

    </div> <!-- /container -->

  </body>
</html>
